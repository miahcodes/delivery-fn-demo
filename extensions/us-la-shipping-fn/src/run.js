// @ts-check

/**
 * @typedef {import("../generated/api").RunInput} RunInput
 * @typedef {import("../generated/api").FunctionRunResult} FunctionRunResult
 */

/**
 * @type {FunctionRunResult}
 */
const NO_CHANGES = {
  operations: [],
};

/**
 * @param {RunInput} input
 * @returns {FunctionRunResult}
 */
export function run(input) {
  // The message to be added to the delivery option
  let zips = [90001,90089,90506,91010,91335,91617,90002,90090,90507,91011,91337,91618,90003,90091,90508,91012,91340,91702,90004,90093,90509,91016,91341,91706,90005,90094,90510,91017,91342,91711,90006,90095,90601,91020,91343,91714,90007,90096,90602,91021,91344,91715,90008,90099,90603,91023,91345,91716,90009,90189,90604,91024,91346,91722,90010,90201,90605,91025,91350,91723,90011,90202,90606,91030,91351,91724,90012,90209,90607,91031,91352,91731,90013,90210,90608,91040,91353,91732,90014,90211,90609,91041,91354,91733,90015,90212,90610,91042,91355,91734,90016,90213,90637,91043,91356,91735,90017,90220,90638,91046,91357,91740,90018,90221,90639,91066,91364,91741,90019,90222,90640,91077,91365,91744,90020,90223,90650,91101,91367,91745,90021,90224,90651,91102,91371,91746,90022,90230,90652,91103,91372,91747,90023,90231,90660,91104,91376,91748,90024,90232,90661,91105,91380,91749,90025,90233,90662,91106,91381,91750,90026,90239,90670,91107,91382,91754,90027,90240,90671,91108,91383,91755,90028,90241,90701,91109,91384,91756,90029,90242,90702,91110,91385,91765,90030,90245,90703,91114,91386,91766,90031,90247,90704,91115,91387,91767,90032,90248,90706,91116,91390,91768,90033,90249,90707,91117,91392,91769,90034,90250,90710,91118,91393,91770,90035,90251,90711,91121,91394,91771,90036,90254,90712,91123,91395,91772,90037,90255,90713,91124,91396,91773,90038,90260,90714,91125,91401,91775,90039,90261,90715,91126,91402,91776,90040,90262,90716,91129,91403,91778,90041,90263,90717,91182,91404,91780,90042,90264,90723,91184,91405,91788,90043,90265,90731,91185,91406,91789,90044,90266,90732,91188,91407,91790,90045,90267,90733,91189,91408,91791,90046,90270,90734,91199,91409,91792,90047,90272,90744,91201,91410,91793,90048,90274,90745,91202,91411,91801,90049,90275,90746,91203,91412,91802,90050,90277,90747,91204,91413,91803,90051,90278,90748,91205,91416,91804,90052,90280,90749,91206,91423,91896,90053,90290,90755,91207,91426,91899,90054,90291,90801,91208,91436,93510,90055,90292,90802,91209,91470,93532,90056,90293,90803,91210,91482,93534,90057,90294,90804,91214,91495,93535,90058,90295,90805,91221,91496,93536,90059,90296,90806,91222,91499,93539,90060,90301,90807,91224,91501,93543,90061,90302,90808,91225,91502,93544,90062,90303,90809,91226,91503,93550,90063,90304,90810,91301,91504,93551,90064,90305,90813,91302,91505,93552,90065,90306,90814,91303,91506,93553,90066,90307,90815,91304,91507,93563,90067,90308,90822,91305,91508,93584,90068,90309,90831,91306,91510,93586,90069,90310,90832,91307,91521,93590,90070,90311,90833,91308,91522,93591,90071,90312,90834,91309,91523,93599,90072,90401,90835,91310,91526,90073,90402,90840,91311,91601,90074,90403,90842,91313,91602,90075,90404,90844,91316,91603,90076,90405,90846,91321,91604,90077,90406,90847,91322,91605,90078,90407,90848,91324,91606,90079,90408,90853,91325,91607,90080,90409,90895,91326,91608,90081,90410,90899,91327,91609,90082,90411,91001,91328,91610,90083,90501,91003,91329,91611,90084,90502,91006,91330,91612,90086,90503,91007,91331,91614,90087,90504,91008,91333,91615,90088,90505,91009,91334,91616];

  let dg = input.cart.deliveryGroups[0];

  let toHide = input.cart.deliveryGroups
    // Collect the delivery options from these groups
    .flatMap(group => group.deliveryOptions)
    // Construct a rename operation for each, adding the message to the option title
    .map(option => /** @type {Operation} */{
      const LA = zips.includes(parseInt(dg?.deliveryAddress?.zip));
      if ((LA && !option.title?.includes('LA')) || (!LA && option.title?.includes('LA'))) {
        return {
          hide: {
            deliveryOptionHandle: option.handle
          }
        }
      } else {
        return {
          move: {
            deliveryOptionHandle: option.handle,
            index: 0
          }
        }
      }
    });

  // The @shopify/shopify_function package applies JSON.stringify() to your function result
  // and writes it to STDOUT
  return {
    operations: toHide,
  };

  return NO_CHANGES;
};
